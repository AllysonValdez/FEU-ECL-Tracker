import React, { useState, useEffect } from 'react';

// Helper function to generate a color from a string
const stringToColor = (str) => {
  if (!str) return '#cccccc';
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = str.charCodeAt(i) + ((hash << 5) - hash);
  }
  let color = '#';
  for (let i = 0; i < 3; i++) {
    let value = (hash >> (i * 8)) & 0xFF;
    color += ('00' + value.toString(16)).substr(-2);
  }
  return color;
};

// Mock Data - Updated to reflect FEU grading system
const initialCourses = [
  { id: 1, code: 'GED0101', name: 'COLLEGE ACADEMIC SKILLS IN ENGLISH (CASE)', units: 3, grade: 'B', semester: '1st Semester, 2024-2025' },
  { id: 2, code: 'GED0106', name: 'ART APPRECIATION', units: 3, grade: 'B+', semester: '1st Semester, 2024-2025' },
  { id: 3, code: 'MGT1101', name: 'LEADERSHIP AND DECISION MAKING', units: 3, grade: 'C+', semester: '1st Semester, 2024-2025' },
  { id: 4, code: 'NST0101', name: 'NATIONAL SERVICE TRAINING PROGRAM 1', units: 3, grade: 'P', semester: '1st Semester, 2024-2025' },
];

// SIMULATED SCRAPED DATA - This now matches the structure from your extension
const initialSchedule = [
    { id: 1, code: 'ACT1123', section: 'ACT1123-LAB A-Sa', description: 'Sample Course A', instructor: 'THOMAS LAZARO', day: 'M', time: '07:30 - 09:00', room: 'CVS-224' },
    { id: 2, code: 'ECL1104', section: 'ECL1104-LEC A-Sa', description: 'Sample Course B', instructor: 'LEONARDO CADA, JR.', day: 'T', time: '13:30 - 15:00', room: 'ONLINE' },
    { id: 3, code: 'TAX1101', section: 'TAX1101-LEC A-Sec9-MN', description: 'Sample Course C', instructor: 'VICENTE GUDANI', day: 'F', time: '13:30 - 15:00', room: 'FC 412' },
    { id: 4, code: 'WRP0205', section: 'WRP0205-LEC-Sec121-MN', description: 'WELLNESS AND RECREATION', instructor: 'RAFAEL PAOLO IRENEO', day: 'F', time: '10:30 - 12:00', room: 'AB 105' },
];


// Grade to GPA mapping aligned with FEU's system
const gradeToGpa = {
  'A': 4.0, 'B+': 3.5, 'B': 3.0, 'C+': 2.5, 'C': 2.0, 'D+': 1.5, 'D': 1.0, 'F': 0.0,
  'P': null, 'NP': null 
};


// Main App Component
export default function App() {
  const [courses, setCourses] = useState(initialCourses);
  const [schedule, setSchedule] = useState(initialSchedule);
  const [gpa, setGpa] = useState(0);
  const [activeTab, setActiveTab] = useState('dashboard');
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [newCourse, setNewCourse] = useState({ code: '', name: '', units: '', grade: '', semester: '' });

  useEffect(() => {
    calculateGpa();
  }, [courses]);

  const calculateGpa = () => {
    let totalQualityPoints = 0;
    let totalUnits = 0;
    courses.forEach(course => {
      if (gradeToGpa[course.grade] !== undefined && gradeToGpa[course.grade] !== null) {
        totalQualityPoints += gradeToGpa[course.grade] * course.units;
        totalUnits += parseInt(course.units);
      }
    });
    setGpa(totalUnits > 0 ? (totalQualityPoints / totalUnits).toFixed(2) : '0.00');
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setNewCourse({ ...newCourse, [name]: value });
  };

  const handleAddCourse = (e) => {
    e.preventDefault();
    if (newCourse.code && newCourse.name && newCourse.units) {
      const courseToAdd = {
        id: courses.length + 1,
        ...newCourse,
        units: parseInt(newCourse.units),
        grade: newCourse.grade.toUpperCase() || 'N/A'
      };
      setCourses([...courses, courseToAdd]);
      setIsModalOpen(false);
      setNewCourse({ code: '', name: '', units: '', grade: '', semester: '' });
    }
  };

  const renderContent = () => {
    switch (activeTab) {
      case 'dashboard':
        return <Dashboard courses={courses} gpa={gpa} schedule={schedule} />;
      case 'courses':
        return <CourseList courses={courses} onAddCourse={() => setIsModalOpen(true)} />;
      case 'schedule':
        return <Schedule schedule={schedule} />;
      default:
        return <Dashboard courses={courses} gpa={gpa} schedule={schedule} />;
    }
  };

  return (
    <div className="bg-gray-100 min-h-screen font-sans">
      <div className="flex">
        <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} />
        <main className="flex-1 p-6 sm:p-8 md:p-10">
          <Header />
          {renderContent()}
        </main>
      </div>
      {isModalOpen && (
        <AddCourseModal
          newCourse={newCourse}
          handleInputChange={handleInputChange}
          handleAddCourse={handleAddCourse}
          onClose={() => setIsModalOpen(false)}
        />
      )}
    </div>
  );
}

// Sidebar Component
const Sidebar = ({ activeTab, setActiveTab }) => {
  const navItems = [
    { id: 'dashboard', label: 'Dashboard', icon: <HomeIcon /> },
    { id: 'courses', label: 'My Courses', icon: <BookOpenIcon /> },
    { id: 'schedule', label: 'Schedule', icon: <CalendarIcon /> },
  ];

  return (
    <aside className="w-16 sm:w-20 md:w-64 bg-white text-gray-800 flex flex-col">
       <div className="h-20 flex items-center justify-center md:justify-start md:px-6 border-b">
        <LeafIcon className="h-8 w-8 text-green-600" />
        <span className="hidden md:inline ml-3 text-lg font-bold">FEU Tracker</span>
      </div>
      <nav className="flex-1 px-2 sm:px-4 md:px-4 py-4">
        {navItems.map(item => (
          <a
            key={item.id}
            href="#"
            onClick={() => setActiveTab(item.id)}
            className={`flex items-center p-2 sm:p-3 my-2 rounded-lg transition-colors ${
              activeTab === item.id
                ? 'bg-green-100 text-green-700'
                : 'text-gray-600 hover:bg-gray-200'
            }`}
          >
            {item.icon}
            <span className="hidden md:inline ml-4">{item.label}</span>
          </a>
        ))}
      </nav>
    </aside>
  );
};

// Header Component
const Header = () => (
  <header className="mb-8">
    <h1 className="text-3xl font-bold text-gray-800">Welcome back, Student!</h1>
    <p className="text-gray-500 mt-1">Here's your academic overview for this semester.</p>
  </header>
);

// Dashboard Component
const Dashboard = ({ courses, gpa, schedule }) => (
  <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <div className="lg:col-span-2">
       <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div className="bg-white p-6 rounded-xl shadow-sm">
          <h3 className="text-lg font-semibold text-gray-700 mb-2">Overall GPA</h3>
          <p className="text-5xl font-bold text-green-600">{gpa}</p>
        </div>
        <div className="bg-white p-6 rounded-xl shadow-sm">
          <h3 className="text-lg font-semibold text-gray-700 mb-2">Enrolled Courses</h3>
          <p className="text-5xl font-bold text-blue-600">{schedule.length}</p>
        </div>
      </div>
      <div className="bg-white p-6 rounded-xl shadow-sm">
        <h3 className="text-xl font-semibold text-gray-800 mb-4">Recent Grades</h3>
        <div className="space-y-4">
          {courses.slice(0, 3).map(course => (
            <div key={course.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
              <div>
                <p className="font-semibold text-gray-700">{course.name}</p>
                <p className="text-sm text-gray-500">{course.code}</p>
              </div>
              <div className="text-lg font-bold" style={{color: stringToColor(course.grade)}}>
                {course.grade}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
    <div className="bg-white p-6 rounded-xl shadow-sm">
      <h3 className="text-xl font-semibold text-gray-800 mb-4">Today's Schedule</h3>
       <div className="space-y-4">
        {schedule.length > 0 ? schedule.slice(0, 4).map(item => (
          <div key={item.id} className="p-4 rounded-lg" style={{borderLeft: `4px solid ${stringToColor(item.code)}`}}>
            <p className="font-semibold text-gray-700">{item.code} - {item.section}</p>
            <p className="text-sm text-gray-600">{item.time} ({item.day})</p>
            <p className="text-xs text-gray-500">{item.room} - {item.instructor}</p>
          </div>
        )) : <p className="text-gray-500">No classes scheduled for today.</p>}
      </div>
    </div>
  </div>
);

// Course List Component
const CourseList = ({ courses, onAddCourse }) => (
  <div className="bg-white p-6 sm:p-8 rounded-xl shadow-sm">
    <div className="flex justify-between items-center mb-6">
      <h2 className="text-2xl font-bold text-gray-800">My Grades</h2>
      <button
        onClick={onAddCourse}
        className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center"
      >
        <PlusIcon className="h-5 w-5 mr-2" />
        Add Grade
      </button>
    </div>
    <div className="overflow-x-auto">
      <table className="w-full text-left">
        <thead>
          <tr className="bg-gray-50 border-b">
            <th className="p-4 font-semibold text-gray-600">Course Code</th>
            <th className="p-4 font-semibold text-gray-600">Course Name</th>
            <th className="p-4 font-semibold text-gray-600">Units</th>
            <th className="p-4 font-semibold text-gray-600">Grade</th>
            <th className="p-4 font-semibold text-gray-600">Semester</th>
          </tr>
        </thead>
        <tbody>
          {courses.map(course => (
            <tr key={course.id} className="border-b hover:bg-gray-50">
              <td className="p-4 text-gray-700">{course.code}</td>
              <td className="p-4 text-gray-800 font-medium">{course.name}</td>
              <td className="p-4 text-gray-700">{course.units}</td>
              <td className="p-4">
                <span className="font-bold px-2 py-1 rounded-full text-sm" style={{backgroundColor: `${stringToColor(course.grade)}20`, color: stringToColor(course.grade)}}>
                  {course.grade}
                </span>
              </td>
              <td className="p-4 text-gray-700">{course.semester}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>
);

// Schedule Component - Updated to show detailed info
const Schedule = ({ schedule }) => {
    return (
    <div className="bg-white p-6 sm:p-8 rounded-xl shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-6">Weekly Schedule</h2>
        <div className="overflow-x-auto">
             <table className="w-full text-left">
                <thead>
                    <tr className="bg-gray-50 border-b">
                        <th className="p-4 font-semibold text-gray-600">Course Code</th>
                        <th className="p-4 font-semibold text-gray-600">Section</th>
                        <th className="p-4 font-semibold text-gray-600">Time</th>
                        <th className="p-4 font-semibold text-gray-600">Day</th>
                        <th className="p-4 font-semibold text-gray-600">Room</th>
                        <th className="p-4 font-semibold text-gray-600">Instructor</th>
                    </tr>
                </thead>
                <tbody>
                    {schedule.map(item => (
                        <tr key={item.id} className="border-b hover:bg-gray-50">
                            <td className="p-4 text-gray-800 font-medium">{item.code}</td>
                            <td className="p-4 text-gray-700">{item.section}</td>
                            <td className="p-4 text-gray-700">{item.time}</td>
                            <td className="p-4 text-gray-700">{item.day}</td>
                            <td className="p-4 text-gray-700">{item.room}</td>
                            <td className="p-4 text-gray-700">{item.instructor}</td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    </div>
    )
};


// Add Course Modal Component
const AddCourseModal = ({ newCourse, handleInputChange, handleAddCourse, onClose }) => (
  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
      <h2 className="text-2xl font-bold mb-6 text-gray-800">Add New Grade</h2>
      <form onSubmit={handleAddCourse}>
        <div className="space-y-4">
          <input type="text" name="code" value={newCourse.code} onChange={handleInputChange} placeholder="Course Code (e.g., CS101)" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500" required />
          <input type="text" name="name" value={newCourse.name} onChange={handleInputChange} placeholder="Course Name" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500" required />
          <input type="number" name="units" value={newCourse.units} onChange={handleInputChange} placeholder="Units" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500" required />
          <input type="text" name="grade" value={newCourse.grade} onChange={handleInputChange} placeholder="Grade (e.g. A, B+, C)" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500" />
          <input type="text" name="semester" value={newCourse.semester} onChange={handleInputChange} placeholder="Semester (e.g., 1st Sem, 2024-2025)" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500" />
        </div>
        <div className="flex justify-end mt-6 space-x-4">
          <button type="button" onClick={onClose} className="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancel</button>
          <button type="submit" className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Add Grade</button>
        </div>
      </form>
    </div>
  </div>
);

// Icon Components
const HomeIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>);
const BookOpenIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>);
const CalendarIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>);
const PlusIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>);
const LeafIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>);

